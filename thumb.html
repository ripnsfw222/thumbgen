<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ðŸŽ¬ Gerador de Thumbnails de VÃ­deo PRO</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>
<style>
/* ðŸŽ¨ Estilos Globais Aprimorados */
:root {
    --primary-color: #1a73e8; /* Azul Google */
    --secondary-color: #34a853; /* Verde para Sucesso/Gerar */
    --accent-color: #fbbc05; /* Amarelo para Destaque */
    --background-color: #f0f3f8; /* Fundo levemente acinzentado */
    --card-background: #ffffff;
    --text-color: #202124;
    --shadow-subtle: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
    --shadow-hover: 0 4px 10px rgba(0, 0, 0, 0.15);
    --danger-color: #e81a30; /* Vermelho para Parar/Limpar */
}

body {
    font-family: 'Roboto', sans-serif;
    padding: 20px;
    background: var(--background-color);
    color: var(--text-color);
    line-height: 1.6;
    /* Ajustado para acomodar a altura do menu fixo */
    margin-top: 130px; 
}

h1 {
    color: var(--primary-color);
    font-weight: 700;
    font-size: 2.2em;
    margin-bottom: 20px;
    border-bottom: 4px solid var(--accent-color);
    padding-bottom: 10px;
    display: inline-block;
}

/* âš™ï¸ Controles Fixos (Sticky Menu) */
.controls-container {
    position: fixed; /* Mudei para 'fixed' para uma melhor experiÃªncia em dispositivos mÃ³veis */
    top: 0;
    left: 0;
    right: 0;
    z-index: 1000;
    background: var(--background-color);
    padding: 0;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.controls-inner {
    max-width: 1200px; /* Limita a largura no centro para telas grandes */
    margin: 0 auto;
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
    align-items: center;
    padding: 15px 20px;
    background: var(--card-background);
    border-bottom: 1px solid #ddd;
}

.action-buttons {
    margin-left: auto; /* Empurra os botÃµes para a direita */
    display: flex;
    gap: 10px;
}

/* ðŸ–¼ï¸ Input de Arquivo (Mais estilizado) */
.file-upload-wrapper {
    position: relative;
    overflow: hidden;
    display: inline-block;
}

#videoInput {
    position: absolute;
    left: 0;
    top: 0;
    opacity: 0;
    cursor: pointer;
    font-size: 100px;
}

.custom-file-upload {
    background-color: var(--primary-color);
    color: white;
    padding: 10px 15px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 500;
    transition: background-color 0.2s;
    display: flex;
    align-items: center;
    gap: 8px;
}

.custom-file-upload:hover {
    background-color: #145cb8;
}

/* â±ï¸ Input de Intervalo */
.input-group {
    display: flex;
    align-items: center;
    gap: 8px;
    border: 1px solid #ddd;
    padding: 8px;
    border-radius: 8px;
    background: #f7f7f7;
}

#intervalInput {
    width: 40px;
    padding: 5px;
    border: 1px solid #ccc;
    border-radius: 4px;
    text-align: center;
}

/* ðŸ”Ž Filtros (Checkbox aprimorado) */
label {
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 500;
    cursor: pointer;
    transition: color 0.2s;
}

label:hover {
    color: var(--primary-color);
}

input[type="checkbox"] {
    /* Mantido o estilo customizado */
    appearance: none;
    width: 18px;
    height: 18px;
    border: 2px solid var(--primary-color);
    border-radius: 4px;
    cursor: pointer;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
}

input[type="checkbox"]:checked {
    background-color: var(--primary-color);
    border-color: var(--primary-color);
}

input[type="checkbox"]:checked::after {
    content: "\f00c"; 
    font-family: "Font Awesome 6 Free";
    font-weight: 900;
    font-size: 12px;
    color: white;
}

/* ðŸ’¡ Status */
#status {
    max-width: 1200px;
    margin: 20px auto;
    padding: 15px;
    background: #e6f0ff;
    border: 1px solid #cce0ff;
    border-left: 5px solid var(--primary-color);
    border-radius: 8px;
    font-weight: 500;
    box-shadow: var(--shadow-subtle);
}

/* ðŸžï¸ Thumbnails Grid: 2 colunas */
#thumbnails {
    max-width: 1200px;
    margin: 20px auto;
    display: grid;
    grid-template-columns: repeat(2, 1fr); /* PadrÃ£o: 2 colunas */
    gap: 30px; /* Aumentei o gap para melhor espaÃ§amento */
}

.thumb-card {
    background: var(--card-background);
    padding: 15px;
    border-radius: 12px;
    text-align: center;
    box-shadow: var(--shadow-subtle);
    transition: transform 0.3s, box-shadow 0.3s;
    display: flex;
    flex-direction: column;
}

.thumb-card:hover {
    transform: translateY(-8px);
    box-shadow: var(--shadow-hover);
}

.thumb-card img {
    width: 100%;
    aspect-ratio: 16 / 9;
    object-fit: cover;
    border-radius: 8px;
    margin-bottom: 10px;
    border: 1px solid #eee;
}

/* ðŸ’¾ BotÃ£o PadrÃ£o */
button {
    background-color: var(--secondary-color);
    color: white;
    padding: 10px 15px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 0.95em;
    font-weight: 500;
    transition: background-color 0.2s, opacity 0.3s, transform 0.1s;
    width: 100%;
    box-sizing: border-box;
    margin-top: 5px;
}

button:hover:not(:disabled) {
    background-color: #2c8c46;
    transform: translateY(-1px);
}

/* BotÃµes de AÃ§Ã£o no topo */
#stopProcessing {
    background-color: var(--danger-color);
}
#stopProcessing:hover:not(:disabled) {
    background-color: #b81427;
}

#clearResults {
    background-color: #6c757d;
}
#clearResults:hover:not(:disabled) {
    background-color: #5a6268;
}

button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

/* Estilo para o botÃ£o 9:16 (cor primÃ¡ria) */
.thumb-card .btn-9-16 {
    background-color: var(--primary-color);
}

.thumb-card .btn-9-16:hover:not(:disabled) {
    background-color: #145cb8;
}


/* ðŸ“± Responsividade Aprimorada */

@media (max-width: 992px) {
    /* Em tablets, mantemos 2 colunas, mas ajustamos o padding */
    .controls-inner {
        gap: 15px;
    }
}

@media (max-width: 768px) {
    /* Em celulares/tablets menores, fazemos os controles em coluna */
    body {
        margin-top: 180px; /* Ajusta a margem para o menu fixo maior */
    }
    .controls-inner {
        flex-direction: column;
        align-items: stretch;
        gap: 15px;
        padding: 10px;
    }
    .action-buttons {
        margin-left: 0;
        width: 100%;
        justify-content: space-between;
    }
    .action-buttons button {
        flex-grow: 1;
    }
    .file-upload-wrapper, .input-group {
        width: 100%; /* Controles de largura total */
    }
    .custom-file-upload {
        justify-content: center;
    }
    #thumbnails {
        grid-template-columns: 1fr; /* Em telas muito pequenas, use 1 coluna */
        gap: 20px;
    }
    /* Filtros em uma linha mais compacta */
    .controls-inner > label {
        width: 45%;
    }
    .controls-inner {
        flex-direction: row; /* Volta a ser row para os filtros ficarem lado a lado */
        justify-content: space-around;
    }
    .action-buttons {
        order: 10; /* Move os botÃµes para o final */
    }
    .file-upload-wrapper {
        order: 1;
    }
    .input-group {
        order: 2;
    }
}
</style>
</head>
<body>

<h1><i class="fas fa-magic"></i> Gerador de Thumbnails Inteligente</h1>

<div class="controls-container">
    <div class="controls-inner">
        
        <div class="file-upload-wrapper">
            <input type="file" id="videoInput" accept="video/*" title="Selecione o arquivo de vÃ­deo">
            <div class="custom-file-upload">
                <i class="fas fa-video fa-lg"></i> Selecionar VÃ­deo
            </div>
        </div>
        
        <div class="input-group">
            <i class="fas fa-clock" style="color: var(--primary-color);"></i>
            <label for="intervalInput">Intervalo (s):</label>
            <input type="number" id="intervalInput" value="15" min="1" title="Intervalo de captura em segundos">
        </div>

        <label title="Apenas frames onde um rosto Ã© detectado">
            <input type="checkbox" id="faceFilter" checked> 
            <i class="fas fa-user" style="color: var(--accent-color);"></i> Rosto
        </label>
        
        <label title="Apenas frames onde os olhos estÃ£o abertos">
            <input type="checkbox" id="eyesOpenFilter" checked> 
            <i class="fas fa-eye" style="color: var(--accent-color);"></i> Olhos Abertos
        </label>
        
        <label title="Baixar tambÃ©m no formato vertical (9:16) com fundo preto e imagem centralizada">
            <input type="checkbox" id="portraitDownload"> 
            <i class="fas fa-mobile-alt" style="color: var(--primary-color);"></i> 9:16 Vertical
        </label>

        <div class="action-buttons">
            <button id="stopProcessing" disabled><i class="fas fa-stop"></i> Parar</button>
            <button id="clearResults"><i class="fas fa-trash-alt"></i> Limpar</button>
        </div>
    </div>
</div>

<div id="status">Carregando modelos de IA...</div>
<div id="thumbnails"></div>

<script>
// Todo o cÃ³digo JavaScript (incluindo as funÃ§Ãµes e o processamento principal)
// permanece o mesmo para manter a funcionalidade original.
// O cÃ³digo JS abaixo Ã© uma repetiÃ§Ã£o exata do seu cÃ³digo original para funcionalidade.

const videoInput = document.getElementById("videoInput");
const intervalInput = document.getElementById("intervalInput");
const faceFilter = document.getElementById("faceFilter");
const eyesOpenFilter = document.getElementById("eyesOpenFilter");
const portraitDownload = document.getElementById("portraitDownload"); // NOVO: VariÃ¡vel 9:16
const thumbsDiv = document.getElementById("thumbnails");
const status = document.getElementById("status");
const stopButton = document.getElementById("stopProcessing");
const clearButton = document.getElementById("clearResults");

// VariÃ¡veis de controle de processo
let stopFlag = false;
let isProcessing = false;

const EYE_OPEN_THRESHOLD = 0.25;Â 
let modelsLoaded = false;

// ConfiguraÃ§Ã£o do detector para SSD Mobilenet V1 (mais preciso)
const faceDetectionOptions = new faceapi.SsdMobilenetv1Options({Â 
Â  Â  minConfidence: 0.5
});

// ResoluÃ§Ãµes alvo para 720p
const RES_720P_LANDSCAPE = { width: 1280, height: 720 }; // 16:9
const RES_720P_PORTRAIT = { width: 720, height: 1280 }; // 9:16 (Inverso)

// FunÃ§Ãµes de AÃ§Ã£o ------------------------------------------------------------------

function enableControls(enable) {
Â  Â  videoInput.disabled = !enable;
Â  Â  intervalInput.disabled = !enable;
Â  Â  faceFilter.disabled = !enable;
Â  Â  eyesOpenFilter.disabled = !enable;
Â  Â  portraitDownload.disabled = !enable; // Adicionado novo controle
}

function updateButtons(processing) {
Â  Â  isProcessing = processing;
Â  Â  stopButton.disabled = !processing;
Â  Â  clearButton.disabled = processing;
Â  Â  enableControls(!processing);
}

stopButton.addEventListener('click', () => {
Â  Â  stopFlag = true;
Â  Â  stopButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Parando...';
Â  Â  stopButton.disabled = true;
});

clearButton.addEventListener('click', () => {
Â  Â  clearResults();
});

function clearResults() {
Â  Â  thumbsDiv.innerHTML = '';
Â  Â  status.innerHTML = modelsLoaded ?Â 
Â  Â  Â  Â  '<i class="fas fa-check-circle" style="color:var(--secondary-color)"></i> Pronto para selecionar um novo vÃ­deo.' :Â 
Â  Â  Â  Â  '<i class="fas fa-hourglass-half fa-spin"></i> Carregando modelos...';
Â  Â  // Remove o arquivo do input para permitir o upload do mesmo arquivo novamente
Â  Â  videoInput.value = '';
Â  Â  updateButtons(false);
}

// ----------------------------------------------------------------------------------


// FunÃ§Ãµes Auxiliares (mantidas)
async function loadModels() {
Â  Â  const MODEL_URL = 'https://raw.githubusercontent.com/justadudewhohacks/face-api.js/master/weights/';
Â  Â  try {
Â  Â  Â  Â  status.innerHTML = '<i class="fas fa-hourglass-half fa-spin"></i> Carregando modelos...';
Â  Â  Â  Â  await faceapi.nets.ssdMobilenetv1.loadFromUri(MODEL_URL);Â 
Â  Â  Â  Â  await faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL);
Â  Â  Â  Â  modelsLoaded = true;
Â  Â  Â  Â  status.innerHTML = '<i class="fas fa-check-circle" style="color:var(--secondary-color)"></i> Modelos carregados! Selecione um vÃ­deo para comeÃ§ar.';
Â  Â  } catch(err) {
Â  Â  Â  Â  status.innerHTML = '<i class="fas fa-exclamation-triangle" style="color:red"></i> Erro ao carregar modelos. Recarregue a pÃ¡gina.';
Â  Â  Â  Â  console.error(err);
Â  Â  }
}
loadModels();

function seekVideo(video, time){
Â  Â  return new Promise(resolve=>{
Â  Â  Â  Â  video.currentTime = time;
Â  Â  Â  Â  if(video.requestVideoFrameCallback){
Â  Â  Â  Â  Â  Â  video.requestVideoFrameCallback(()=>resolve());
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  video.addEventListener('seeked', resolve, {once:true});
Â  Â  Â  Â  }
Â  Â  });
}

function downloadImage(dataURL, filename){
Â  Â  const a = document.createElement('a');
Â  Â  a.href = dataURL;
Â  Â  a.download = filename;
Â  Â  a.click();
}

function eyeOpenRatio(eye){
Â  Â  const vertical1 = distance(eye[1], eye[5]);
Â  Â  const vertical2 = distance(eye[2], eye[4]);
Â  Â  const horizontal = distance(eye[0], eye[3]);
Â  Â  return (vertical1 + vertical2) / (2 * horizontal + 1e-6);Â 
}

function distance(p1,p2){
Â  Â  return Math.hypot(p1.x-p2.x, p1.y-p2.y);
}


// FUNÃ‡ÃƒO resizeCanvas (para 16:9 ou 9:16 com fundo preto/centralizaÃ§Ã£o)
function resizeCanvas(originalCanvas, videoWidth, videoHeight, isPortraitMode) {
Â  Â  // Define as dimensÃµes do canvas alvo
Â  Â  const TARGET_WIDTH = isPortraitMode ? RES_720P_PORTRAIT.width : RES_720P_LANDSCAPE.width;
Â  Â  const TARGET_HEIGHT = isPortraitMode ? RES_720P_PORTRAIT.height : RES_720P_LANDSCAPE.height;

Â  Â  const resizedCanvas = document.createElement("canvas");
Â  Â  resizedCanvas.width = TARGET_WIDTH;
Â  Â  resizedCanvas.height = TARGET_HEIGHT;
Â  Â  const ctx = resizedCanvas.getContext("2d");

Â  Â  // 1. Aplica o fundo preto se for modo vertical (9:16)
Â  Â  if (isPortraitMode) {
Â  Â  Â  Â  ctx.fillStyle = "#000000"; // Fundo preto
Â  Â  Â  Â  ctx.fillRect(0, 0, TARGET_WIDTH, TARGET_HEIGHT);
Â  Â  }
Â  Â Â 
Â  Â  // 2. Calcula as dimensÃµes para o modo "Fit" (manter proporÃ§Ã£o e caber no canvas)
Â  Â  let drawWidth, drawHeight, xOffset, yOffset;
Â  Â Â 
Â  Â  const targetRatio = TARGET_WIDTH / TARGET_HEIGHT;
Â  Â  const originalRatio = videoWidth / videoHeight;

Â  Â  if (originalRatio > targetRatio) {
Â  Â  Â  Â  // O frame do vÃ­deo Ã© mais largo em relaÃ§Ã£o ao alvo: ajustar pela largura
Â  Â  Â  Â  drawWidth = TARGET_WIDTH;
Â  Â  Â  Â  drawHeight = TARGET_WIDTH / originalRatio;
Â  Â  } else {
Â  Â  Â  Â  // O frame do vÃ­deo Ã© mais alto em relaÃ§Ã£o ao alvo: ajustar pela altura
Â  Â  Â  Â  drawHeight = TARGET_HEIGHT;
Â  Â  Â  Â  drawWidth = TARGET_HEIGHT * originalRatio;
Â  Â  }

Â  Â  // 3. Centraliza a imagem no canvas alvo
Â  Â  xOffset = (TARGET_WIDTH - drawWidth) / 2;
Â  Â  yOffset = (TARGET_HEIGHT - drawHeight) / 2;

Â  Â  // 4. Desenha o frame original redimensionado e centralizado
Â  Â  ctx.drawImage(originalCanvas, 0, 0, videoWidth, videoHeight, xOffset, yOffset, drawWidth, drawHeight);
Â  Â Â 
Â  Â  return resizedCanvas;
}


// Processamento Principal (ATUALIZADO para gerar os dois formatos) ----------------------------------------------------------

videoInput.addEventListener("change", async ()=>{
Â  Â  thumbsDiv.innerHTML = '';
Â  Â  const file = videoInput.files[0];
Â  Â  if(!file) return;
Â  Â  if(!modelsLoaded){
Â  Â  Â  Â  alert("Aguarde os modelos de IA carregarem antes de enviar o vÃ­deo!");
Â  Â  Â  Â  return;
Â  Â  }

Â  Â  // Inicializa o processo
Â  Â  stopFlag = false;
Â  Â  updateButtons(true);
Â  Â  stopButton.innerHTML = '<i class="fas fa-stop"></i> Parar';

Â  Â  const url = URL.createObjectURL(file);
Â  Â  const video = document.createElement("video");
Â  Â  video.src = url;
Â  Â  video.muted = true;
Â  Â  video.preload = "metadata";
Â  Â  video.style.display = 'none';Â 

Â  Â  document.body.appendChild(video);Â 

Â  Â  await new Promise(resolve => video.addEventListener('loadedmetadata', resolve, {once:true}));
Â  Â  const duration = video.duration;
Â  Â  const interval = parseInt(intervalInput.value) || 15;
Â  Â  const filterFace = faceFilter.checked;
Â  Â  const filterEyes = eyesOpenFilter.checked;
Â  Â  const filterPortrait = portraitDownload.checked; // Captura o estado do novo filtro
Â  Â  Â 
Â  Â  const videoWidth = video.videoWidth;
Â  Â  const videoHeight = video.videoHeight;

Â  Â  status.innerHTML = `<i class="fas fa-cogs fa-spin"></i> Processando frames...`;

Â  Â  let generated = 0;
Â  Â  let totalFrames = Math.ceil(duration/interval);
Â  Â  let framesProcessed = 0;

Â  Â  for(let t=0; t<duration; t+=interval){
Â  Â  Â  Â  if(stopFlag) {
Â  Â  Â  Â  Â  Â  status.innerHTML = `<i class="fas fa-times-circle" style="color:var(--danger-color)"></i> Processamento interrompido pelo usuÃ¡rio. **${generated}** thumbnails geradas.`;
Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  }

Â  Â  Â  Â  await seekVideo(video,t);

Â  Â  Â  Â  const originalCanvas = document.createElement("canvas");
Â  Â  Â  Â  originalCanvas.width = videoWidth;
Â  Â  Â  Â  originalCanvas.height = videoHeight;
Â  Â  Â  Â  const ctx = originalCanvas.getContext("2d");
Â  Â  Â  Â  ctx.drawImage(video,0,0,originalCanvas.width,originalCanvas.height);

Â  Â  Â  Â  let passFilters = true;
Â  Â  Â  Â  if(filterFace || filterEyes){
Â  Â  Â  Â  Â  Â  const detections = await faceapi.detectAllFaces(originalCanvas, faceDetectionOptions).withFaceLandmarks();
Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  if(filterFace && detections.length===0) passFilters=false;
Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  if(filterEyes && detections.length>0 && passFilters){
Â  Â  Â  Â  Â  Â  Â  Â  for(const det of detections){
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const leftEye = det.landmarks.getLeftEye();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const rightEye = det.landmarks.getRightEye();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const ratioL = eyeOpenRatio(leftEye);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const ratioR = eyeOpenRatio(rightEye);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(ratioL < EYE_OPEN_THRESHOLD || ratioR < EYE_OPEN_THRESHOLD){
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  passFilters=false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  if(passFilters){
Â  Â  Â  Â  Â  Â  // -----------------------------------------------------------
Â  Â  Â  Â  Â  Â  // 1. GeraÃ§Ã£o do Thumbnail 16:9 PadrÃ£o (1280x720)
Â  Â  Â  Â  Â  Â  const finalCanvas_16_9 = resizeCanvas(originalCanvas, videoWidth, videoHeight, false);Â 
Â  Â  Â  Â  Â  Â  const dataURL_16_9 = finalCanvas_16_9.toDataURL("image/jpeg",0.95);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const card = document.createElement("div");
Â  Â  Â  Â  Â  Â  card.className="thumb-card";
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Imagem de preview principal (16:9)
Â  Â  Â  Â  Â  Â  const img_16_9 = document.createElement("img");Â 
Â  Â  Â  Â  Â  Â  img_16_9.src=dataURL_16_9;
Â  Â  Â  Â  Â  Â  img_16_9.style.aspectRatio = '16 / 9';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // BotÃ£o de Download 16:9
Â  Â  Â  Â  Â  Â  const btn_16_9 = document.createElement("button");
Â  Â  Â  Â  Â  Â  btn_16_9.innerHTML = `<i class="fas fa-download"></i> Salvar 16:9 frame ${Math.floor(t)}s`;
Â  Â  Â  Â  Â  Â  btn_16_9.onclick = ()=>downloadImage(dataURL_16_9, `thumb_16_9_${Math.floor(t)}s.jpg`);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  card.appendChild(img_16_9);Â 
Â  Â  Â  Â  Â  Â  card.appendChild(btn_16_9);

Â  Â  Â  Â  Â  Â  // -----------------------------------------------------------
Â  Â  Â  Â  Â  Â  // 2. GeraÃ§Ã£o do Thumbnail 9:16 (720x1280) com Fundo Preto
Â  Â  Â  Â  Â  Â  if(filterPortrait){
Â  Â  Â  Â  Â  Â  Â  Â  const finalCanvas_9_16 = resizeCanvas(originalCanvas, videoWidth, videoHeight, true);Â 
Â  Â  Â  Â  Â  Â  Â  Â  const dataURL_9_16 = finalCanvas_9_16.toDataURL("image/jpeg",0.95);
Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // BotÃ£o de Download 9:16
Â  Â  Â  Â  Â  Â  Â  Â  const btn_9_16 = document.createElement("button");
Â  Â  Â  Â  Â  Â  Â  Â  btn_9_16.classList.add('btn-9-16');
Â  Â  Â  Â  Â  Â  Â  Â  btn_9_16.innerHTML = `<i class="fas fa-mobile-alt"></i> Salvar 9:16 frame ${Math.floor(t)}s`;
Â  Â  Â  Â  Â  Â  Â  Â  btn_9_16.onclick = ()=>downloadImage(dataURL_9_16, `thumb_9_16_${Math.floor(t)}s.jpg`);

Â  Â  Â  Â  Â  Â  Â  Â  card.appendChild(btn_9_16);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  // -----------------------------------------------------------

Â  Â  Â  Â  Â  Â  thumbsDiv.appendChild(card);
Â  Â  Â  Â  Â  Â  generated++;
Â  Â  Â  Â  }
Â  Â  Â  Â  Â 
Â  Â  Â  Â  framesProcessed++;
Â  Â  Â  Â  status.innerHTML = `<i class="fas fa-cogs fa-spin"></i> Processando frames... (${framesProcessed}/${totalFrames}) | Geradas: **${generated}**`;
Â  Â  Â  Â  await new Promise(r=>setTimeout(r,10));Â 
Â  Â  }

Â  Â  if (!stopFlag) {
Â  Â  Â  Â  status.innerHTML = generated > 0 ?Â 
Â  Â  Â  Â  Â  Â  `<i class="fas fa-check-circle" style="color:var(--secondary-color)"></i> Processamento concluÃ­do! **${generated}** thumbnails geradas.` :Â 
Â  Â  Â  Â  Â  Â  '<i class="fas fa-exclamation-triangle" style="color:red"></i> Nenhuma thumbnail gerada. Tente desativar os filtros ou aumentar o intervalo.';
Â  Â  }
Â  Â  Â 
Â  Â  // Finaliza o processo
Â  Â  updateButtons(false);
Â  Â  URL.revokeObjectURL(url);
Â  Â  video.remove();
});
</script>

</body>
</html>
