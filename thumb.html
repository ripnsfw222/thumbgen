<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <title>Gerador de Thumbnails de Vídeo</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0 20px;
            background: linear-gradient(135deg, #e0f0ff, #f9f9f9);
            color: #333;
        }

        h1 {
            text-align: center;
            margin: 30px 0 20px;
            font-weight: 700;
            color: #007BFF;
        }

        form {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }

        input[type="file"] {
            padding: 12px 20px;
            font-size: 16px;
            border-radius: 10px;
            border: 1px solid #ccc;
            cursor: pointer;
            background: #fff;
            transition: all 0.3s;
        }

        input[type="file"]:hover {
            border-color: #007BFF;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 50px;
        }

        @media (max-width: 700px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }

        .thumb-card {
            background: #fff;
            border: 2px solid #007BFF;
            border-radius: 20px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 123, 255, 0.2);
            transition: transform 0.4s, box-shadow 0.4s;
        }

        .thumb-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 15px 40px rgba(0, 123, 255, 0.3);
        }

        .thumb-card img {
            width: 100%;
            border-radius: 15px;
            margin-bottom: 12px;
            transition: transform 0.3s;
        }

        .thumb-card img:hover {
            transform: scale(1.05);
        }

        .thumb-card button {
            background: linear-gradient(90deg, #007BFF, #00BFFF);
            color: #fff;
            border: none;
            border-radius: 12px;
            padding: 12px 25px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s, background 0.3s;
        }

        .thumb-card button:hover {
            transform: scale(1.1);
            background: linear-gradient(90deg, #0056b3, #0080ff);
        }

        @media (max-width: 500px) {
            h1 {
                font-size: 24px;
            }

            input[type="file"] {
                width: 100%;
            }
        }
    </style>
    <!-- Biblioteca de compressão -->
    <script src="https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.1/dist/browser-image-compression.js"></script>
</head>

<body>
    <h1>Gerador de Thumbnails de Vídeo</h1>
    <form>
        <input type="file" id="videoInput" accept="video/*" required>
    </form>

    <div id="thumbnails" class="grid"></div>

    <script>
        const videoInput = document.getElementById("videoInput");
        const thumbsDiv = document.getElementById("thumbnails");

        videoInput.addEventListener("change", async () => {
            const file = videoInput.files[0];
            if (!file) return;

            thumbsDiv.innerHTML = "";
            const url = URL.createObjectURL(file);
            const video = document.createElement("video");
            video.src = url;
            video.preload = "metadata";
            video.muted = true;

            await new Promise(resolve => video.addEventListener("loadedmetadata", resolve));
            const duration = video.duration;
            const interval = 30; // captura a cada 30s

            for (let t = 0; t < duration; t += interval) {
                await captureFrame(video, t, file.name);
            }
        });

        async function captureFrame(video, time, videoName) {
            return new Promise(resolve => {
                video.currentTime = time;
                video.addEventListener("seeked", async function handler() {
                    const canvas = document.createElement("canvas");
                    canvas.width = video.videoWidth / 2;
                    canvas.height = video.videoHeight / 2;
                    const ctx = canvas.getContext("2d");
                    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

                    const dataURL = canvas.toDataURL("image/jpg");

                    const card = document.createElement("div");
                    card.className = "thumb-card";

                    const img = document.createElement("img");
                    img.src = dataURL;

                    const btn = document.createElement("button");
                    btn.textContent = "Salvar";

                    btn.onclick = () => {
                      canvas.toBlob((blob) => {
                          // Aqui o blob já é JPEG leve, qualidade 0.95
                          const compressedURL = URL.createObjectURL(blob);

                          const link = document.createElement("a");
                          link.href = compressedURL;
                          link.download = videoName.replace(/\.[^/.]+$/, "") + ".jpg";
                          link.click();
                      }, "image/jpeg", 0.95); // qualidade alta = menos compressão
                  };




                    card.appendChild(img);
                    card.appendChild(btn);
                    thumbsDiv.appendChild(card);

                    video.removeEventListener("seeked", handler);
                    resolve();
                });
            });
        }

        // Função auxiliar: dataURL -> File
        function dataURLtoFile(dataurl, filename) {
            const arr = dataurl.split(',');
            const mime = arr[0].match(/:(.*?);/)[1];
            const bstr = atob(arr[1]);
            let n = bstr.length;
            const u8arr = new Uint8Array(n);
            while (n--) {
                u8arr[n] = bstr.charCodeAt(n);
            }
            return new File([u8arr], filename, { type: mime });
        }
    </script>
</body>

</html>
